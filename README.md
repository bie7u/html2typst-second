# HTML to Typst Translator

Production-quality Python translator that converts HTML (generated by Quill.js) to Typst code.

## Features

- **100% Text Preservation**: Guaranteed no text loss - every piece of content is preserved
- **Quill.js Support**: Full support for Quill.js classes and styles
- **Two Modes**: Production mode (clean output) and Debug mode (with diagnostics)
- **Fail-Safe Design**: Structure and style may simplify, but text is never lost
- **Modular & Extensible**: Easy to extend with new HTML tags and style mappings

## Installation

No external dependencies required - uses only Python standard library:

```bash
# Clone the repository
git clone https://github.com/bie7u/html2typst-second.git
cd html2typst-second

# The module is ready to use - no installation needed
```

## Quick Start

```python
from src.html2typst import translate_html_to_typst

# Basic usage
html = "<p>Hello <strong>world</strong></p>"
typst = translate_html_to_typst(html)
print(typst)  # Output: Hello *world*

# With debug mode
html = "<p><custom>Unknown tag</custom></p>"
typst = translate_html_to_typst(html, debug=True)
print(typst)  # Output includes debug comments
```

## API

### Main Function

```python
translate_html_to_typst(html: str, debug: bool = False) -> str
```

**Parameters:**
- `html` (str): HTML string to convert
- `debug` (bool): If True, include debug comments and warnings in output

**Returns:**
- str: Typst code

## Supported HTML Elements

### Basic Formatting

| HTML | Typst | Notes |
|------|-------|-------|
| `<p>`, `<div>` | Paragraph | Converted to paragraphs |
| `<br>` | `\\` | Line break |
| `<strong>`, `<b>` | `*text*` or `#strong[text]` | Bold (uses function syntax to avoid delimiter collisions) |
| `<em>`, `<i>` | `_text_` or `#emph[text]` | Italic (uses function syntax to avoid delimiter collisions) |
| `<sup>` | `#super[text]` | Superscript |
| `<sub>` | `#sub[text]` | Subscript |
| `<u>`, `<s>` | Plain text | Style ignored, text preserved |

### Headings

| HTML | Typst |
|------|-------|
| `<h1>` | `= Heading` |
| `<h2>` | `== Heading` |
| `<h3>` | `=== Heading` |
| `<h4>` | `==== Heading` |
| `<h5>` | `===== Heading` |
| `<h6>` | `====== Heading` |

### Lists

| HTML | Typst | Notes |
|------|-------|-------|
| `<ul><li>` | `- item` | Unordered list |
| `<ol><li>` | `+ item` | Ordered list |
| `<li class="ql-indent-1">` | `  - item` | Indented list item |

### Quill.js Classes

| Class | Effect | Notes |
|-------|--------|-------|
| `ql-align-center` | `#align(center)[...]` | Center alignment |
| `ql-align-right` | `#align(right)[...]` | Right alignment |
| `ql-align-left` | Default | Left alignment |
| `ql-indent-N` | N Ã— 2 spaces | List indentation |
| `ql-size-small` | `#text(size: 0.75em)` | Small text |
| `ql-size-large` | `#text(size: 1.5em)` | Large text |
| `ql-size-huge` | `#text(size: 2.5em)` | Huge text |
| `ql-font-*` | `#text(font: "...")` | Font family |

### Inline Styles

| Style | Typst | Notes |
|-------|-------|-------|
| `color: red` | `#text(fill: red)` | Text color |
| `background-color: yellow` | `#highlight(fill: yellow)` | Highlight |
| `font-size: 14px` | `#text(size: 14px)` | Font size |
| `font-family: Arial` | `#text(font: "Arial")` | Font family |
| `font-weight: bold` | `*text*` | Bold weight |
| `font-style: italic` | `_text_` | Italic style |

### Other Elements

| HTML | Typst | Notes |
|------|-------|-------|
| `<blockquote>` | `> quote` | Block quote |
| `<code>` | `` `code` `` | Inline code |
| `<pre><code>` | ` ```code``` ` | Code block |
| `<a href="url">` | `#link("url")[text]` | Hyperlink |
| `<img src="url" alt="desc">` | `#image("url", alt: "desc")` | Image |

## Mode Comparison

### Production Mode (debug=False)

- Clean output for end users
- No debug comments or warnings
- Unsupported styles/tags are silently ignored
- **All text is still preserved**

```python
html = '<p><unknown>Text</unknown></p>'
typst = translate_html_to_typst(html, debug=False)
# Output: "Text\n\n"
```

### Debug Mode (debug=True)

- Includes diagnostic comments
- Reports unsupported tags, styles, and classes
- Helps identify conversion issues
- **All text is still preserved**

```python
html = '<p><unknown>Text</unknown></p>'
typst = translate_html_to_typst(html, debug=True)
# Output: "/* unsupported tag: unknown */ Text\n\n"
```

## Examples

Run the demo script to see various examples:

```bash
python examples/demo.py
```

### Example 1: Basic Document

```python
html = """
<h1>My Document</h1>
<p>This is a <strong>sample</strong> document.</p>
<ul>
    <li>Item 1</li>
    <li>Item 2</li>
</ul>
"""

typst = translate_html_to_typst(html)
```

Output:
```typst
= My Document

This is a *sample* document.

- Item 1
- Item 2
```

### Example 2: Quill.js Content

```python
html = """
<p class="ql-align-center">Centered Title</p>
<ul>
    <li>Main point</li>
    <li class="ql-indent-1">Sub-point A</li>
    <li class="ql-indent-1">Sub-point B</li>
</ul>
<p><span style="color: red;">Important:</span> Read carefully!</p>
"""

typst = translate_html_to_typst(html)
```

Output:
```typst
#align(center)[Centered Title]

- Main point
  - Sub-point A
  - Sub-point B

#text(fill: red)[Important:] Read carefully!
```

## Testing

Run the comprehensive test suite:

```bash
python tests/test_html2typst.py
```

The test suite covers:
- Text preservation (critical requirement)
- All HTML tag mappings
- Quill.js classes and styles
- Debug mode functionality
- Edge cases and fail-safe behavior

## Design Principles

### 1. Text Preservation (Critical)
- **100% of text** from HTML must appear in output
- No text can be lost or omitted
- Every HTML node is either:
  - Explicitly mapped to Typst
  - Degraded to render its content as plain text

### 2. Structure Over Style
- Semantic structure (lists, headings, paragraphs) has priority
- Inline styles and classes are analyzed
- Lack of support for a style **never** affects text presence

### 3. Fail-Safe Behavior
- Style may disappear
- Structure may simplify
- **Text never disappears**

### 4. Quill.js Compatibility
- Handles Quill.js generated HTML
- Supports common Quill classes (`ql-indent-*`, `ql-align-*`, etc.)
- Gracefully degrades unsupported features

## Architecture

The translator uses a clean, modular architecture:

1. **HTML Parsing**: Uses Python's `html.parser.HTMLParser`
2. **Context Management**: `RenderContext` tracks state during parsing
3. **Tag-based Rendering**: Different handlers for each HTML element type
4. **Style Processing**: Inline styles and CSS classes are parsed and applied
5. **Output Generation**: Builds Typst code incrementally

## Extending the Translator

To add support for new HTML tags or styles:

1. Add handling in the `handle_data()` method
2. Update style parsing in `apply_span_styles()`
3. Add tests in `tests/test_html2typst.py`

## Requirements

- Python 3.6+
- No external dependencies (uses standard library only)

## License

MIT License - see repository for details

## Contributing

Contributions welcome! Please ensure:
- All tests pass
- Text preservation is maintained
- New features include tests

## Author

Created as part of the html2typst-second project.