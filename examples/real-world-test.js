/**
 * Real-world end-to-end test with actual Quill.js output
 */

const { translateHtmlToTypst } = require('../dist/index');

// This is actual HTML that could be generated by Quill.js
const quillHtml = `
<h1>Project Documentation</h1>

<p><strong>Project Name:</strong> HTML to Typst Converter</p>
<p><strong>Version:</strong> 1.0.0</p>
<p><em>Last Updated:</em> February 2024</p>

<h2>Overview</h2>

<p>This project provides a <strong>production-quality</strong> translator that converts HTML from Quill.js into <em>Typst format</em>.</p>

<h2>Features</h2>

<ul>
  <li>Text formatting (bold, italic)</li>
  <li>Multiple heading levels</li>
  <li class="ql-indent-1">Nested lists with indentation</li>
  <li class="ql-indent-2">Even deeper nesting</li>
  <li>Code blocks and inline code</li>
</ul>

<h2>Usage Example</h2>

<p>Here's how to use the translator:</p>

<pre><code>import { translateHtmlToTypst } from 'html2typst-second';

const html = '&lt;p&gt;&lt;strong&gt;Hello&lt;/strong&gt; world!&lt;/p&gt;';
const typst = translateHtmlToTypst(html);
console.log(typst);</code></pre>

<h2>Key Principles</h2>

<blockquote>
  <p>100% of text content must appear in output. Text preservation is sacrosanct.</p>
</blockquote>

<p class="ql-align-center"><strong>Structure always takes priority over styling</strong></p>

<h2>Supported Tags</h2>

<ol>
  <li>Paragraphs and divs</li>
  <li>Headings (H1-H6)</li>
  <li>Lists (ordered and unordered)</li>
  <li>Text formatting</li>
  <li>Code blocks</li>
  <li>Links and images</li>
</ol>

<h2>Contact</h2>

<p>For more information, visit <a href="https://github.com">our repository</a>.</p>

<p class="ql-align-right"><em>End of Documentation</em></p>
`;

console.log('='.repeat(80));
console.log('REAL-WORLD QUILL.JS TO TYPST CONVERSION TEST');
console.log('='.repeat(80));
console.log();

console.log('INPUT HTML (excerpt):');
console.log(quillHtml.substring(0, 300) + '...');
console.log();

console.log('='.repeat(80));
console.log('OUTPUT TYPST:');
console.log('='.repeat(80));
console.log();

const result = translateHtmlToTypst(quillHtml);
console.log(result);

console.log();
console.log('='.repeat(80));
console.log('VERIFICATION CHECKS');
console.log('='.repeat(80));
console.log();

// Verify critical text is present
const criticalTexts = [
  'Project Documentation',
  'HTML to Typst Converter',
  'Version:',
  '1.0.0',
  'Overview',
  'production-quality',
  'Features',
  'Text formatting',
  'Nested lists',
  'Usage Example',
  'translateHtmlToTypst',
  'Key Principles',
  '100% of text',
  'Structure always takes priority',
  'Supported Tags',
  'Paragraphs and divs',
  'Contact',
  'our repository',
  'End of Documentation'
];

let allPresent = true;
criticalTexts.forEach(text => {
  const present = result.includes(text);
  if (!present) {
    console.log(`‚ùå MISSING: "${text}"`);
    allPresent = false;
  }
});

if (allPresent) {
  console.log('‚úÖ All critical text content is present!');
}

// Verify structure
const structureChecks = [
  { pattern: /^= Project Documentation/m, desc: 'H1 heading format' },
  { pattern: /^== Overview/m, desc: 'H2 heading format' },
  { pattern: /\*production-quality\*/m, desc: 'Bold formatting' },
  { pattern: /_Typst format_/m, desc: 'Italic formatting' },
  { pattern: /^- Text formatting/m, desc: 'Unordered list' },
  { pattern: /^\s+- Nested lists/m, desc: 'Indented list item' },
  { pattern: /^\+ Paragraphs and divs/m, desc: 'Ordered list' },
  { pattern: /```[\s\S]*translateHtmlToTypst/m, desc: 'Code block' },
  { pattern: /> 100% of text/m, desc: 'Blockquote' },
  { pattern: /#align\(center\)/m, desc: 'Center alignment' },
  { pattern: /#align\(right\)/m, desc: 'Right alignment' },
  { pattern: /#link\("https:\/\/github.com"\)/m, desc: 'Link' }
];

console.log();
structureChecks.forEach(check => {
  const matches = check.pattern.test(result);
  console.log(`${matches ? '‚úÖ' : '‚ùå'} ${check.desc}`);
  if (!matches && !allPresent) {
    allPresent = false;
  }
});

console.log();
console.log('='.repeat(80));
if (allPresent) {
  console.log('üéâ ALL TESTS PASSED! The translator is working correctly.');
} else {
  console.log('‚ö†Ô∏è  Some checks failed. Please review the output.');
}
console.log('='.repeat(80));
